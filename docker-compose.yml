name: panbox-autosave
services:
  panbox-autosave:
    image: kokojacket/panbox-autosave:latest
    container_name: panbox-autosave
    restart: unless-stopped
    depends_on:
      - postgres

    ports:
      - "1888:8000"

    volumes:
      # 持久化日志目录
      - /opt/panbox-autosave/logs:/app/logs

    environment:
      # 数据库配置 - PostgreSQL（默认）
      DB_TYPE: "postgresql"
      DB_HOST: "postgres"
      DB_PORT: "5432"
      DB_USER: "panbox-autosave"
      DB_PASSWORD: "panbox-autosave"
      DB_NAME: "panbox-autosave"

      # API 配置
      API_HOST: "0.0.0.0"
      API_PORT: "8000"

      # 日志配置
      LOG_LEVEL: "DEBUG"

      # 静态文件路径（容器内）
      STATIC_DIR: "/app/static"

      # License Mate 配置
      LICENSE_MATE_BASE_URL: "https://license.panbox.online"
      LICENSE_MATE_PRODUCT_NAME: "panbox-autosave"
      LICENSE_CACHE_TTL_SECONDS: "300"

    # 安全配置
    cap_drop:
      - ALL

    # 资源限制（可选，根据实际需求调整）
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 256M

  postgres:
    image: postgres:16-alpine
    container_name: panbox-autosave-postgres
    restart: unless-stopped

    environment:
      POSTGRES_DB: panbox-autosave
      POSTGRES_USER: panbox-autosave
      POSTGRES_PASSWORD: panbox-autosave

    volumes:
      - /opt/panbox-autosave/postgres:/var/lib/postgresql/data

    # PostgreSQL 不限制 capabilities（数据库需要完整的文件系统权限）
